importScripts("base.js");
function Jn(a,b,c,d,e,f,g){var k=new a.btVector3(0,0,0);c=new a.btDefaultMotionState(c);fe(0,d)&&b.calculateLocalInertia(d,k);b=new a.btRigidBodyConstructionInfo(d,c,b,k);b.set_m_friction(e);b.set_m_rollingFriction(f);b.set_m_restitution(g);return new a.btRigidBody(b)}
function Kn(a,b){var c=b.shape;switch(c){case "box":var d=b.size;b=W(d,0,null);c=W(d,1,null);d=W(d,2,null);return new a.btBoxShape(new a.btVector3(b,c,d));case "sphere":return new a.btSphereShape(b.radius);default:throw Error(["No matching clause: ",D.f(c)].join(""));}}
function Ln(a,b,c){var d=Mn,e=W(b,0,null),f=W(b,1,null);b=W(b,2,null);var g=W(c,0,null),k=W(c,1,null),l=W(c,2,null);c=W(c,3,null);var m=Kn(d,a),n=new d.btTransform;n.setOrigin(new d.btVector3(e,f,b));n.setRotation(new d.btQuaternion(g,k,l,c));return Jn(d,m,n,a.mass,function(){var p=a.friction;return C(p)?p:.5}(),function(){var p=a.rollingFriction;return C(p)?p:0}(),function(){var p=a.restitution;return C(p)?p:0}())}
function Nn(a,b){var c=On,d=Pn;a=a.getMotionState();C(a)&&(a.getWorldTransform(c),a=c.getOrigin(),c=c.getRotation(),d[b]=a.x(),d[b+1]=a.y(),d[b+2]=a.z(),d[b+3]=c.x(),d[b+4]=c.y(),d[b+5]=c.z(),d[b+6]=c.w())};var Qn={};if("undefined"===typeof pa||"undefined"===typeof Qn||"undefined"===typeof Rn)var Rn=4E3;if("undefined"===typeof pa||"undefined"===typeof Qn||"undefined"===typeof Mn)var Mn=null;if("undefined"===typeof pa||"undefined"===typeof Qn||"undefined"===typeof Sn)var Sn=null;if("undefined"===typeof pa||"undefined"===typeof Qn||"undefined"===typeof Vn)var Vn=[];if("undefined"===typeof pa||"undefined"===typeof Qn||"undefined"===typeof On)var On=null;
if("undefined"===typeof pa||"undefined"===typeof Qn||"undefined"===typeof Pn)var Pn=new Float32Array(7*Rn);if("undefined"===typeof pa||"undefined"===typeof Qn||"undefined"===typeof Wn)var Wn=1/60;self.importScripts("./ammo.js");
function Xn(){Sn.stepSimulation(Wn,2);for(var a=K(Wf(S(Vn))),b=null,c=0,d=0;;)if(d<c){var e=b.P(null,d),f=Vn[e];C(f)&&Nn(f,7*e);d+=1}else if(a=K(a))md(a)?(c=Xb(a),a=Yb(a),b=c,c=S(c)):(b=O(a),c=Vn[b],C(c)&&Nn(c,7*b),a=R(a),b=null,c=0),d=0;else break;return self.postMessage({type:"tick",data:Pn})}
function Yn(){var a=Mn,b=new a.btDefaultCollisionConfiguration,c=new a.btCollisionDispatcher(b),d=new a.btDbvtBroadphase,e=new a.btSequentialImpulseConstraintSolver;b=new a.btDiscreteDynamicsWorld(c,d,e,b);b.setGravity(new a.btVector3(0,-9.8,0));c=new a.btBoxShape(new a.btVector3(50,.1,50));d=new a.btTransform;d.setIdentity();d.setOrigin(new a.btVector3(0,0,0));c=Jn(a,c,d,0,.5,0,0);b.addRigidBody(c);Sn=b;On=new a.btTransform;Vn=[];return self.setInterval(Xn,1E3/60)}
function Zn(a){var b=a.data.type;switch(b){case "add-body":return b=Sn,a=a.data.data,a=Ln(a.body,a.pos,a.rot),b.addRigidBody(a),Vn.push(a);case "reset":return Yn();default:throw Error(["No matching clause: ",D.f(b)].join(""));}}self.Ammo().then(function(){var a=self.Ammo;self.addEventListener("message",Zn);Mn=a;self.postMessage(og(new Sa(null,2,[Lg,"log",Hg,"starting sim..."],null)));Yn();return self.postMessage(og(new Sa(null,2,[Lg,"ready",Hg,null],null)))});Ug(["shadow.module.ammo-worker.append","physics.ammo","physics.worker"]);